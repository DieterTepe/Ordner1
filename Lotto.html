<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lotto 6aus49 KI-Analyzer</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@1.1.0/dist/chartjs-chart-matrix.min.js"></script>
  <style>
    :root {
      --hot-color: #ff4444;
      --cold-color: #4285f4;
      --neutral-color: #4CAF50;
      --button-bg: #4CAF50;
      --button-hover: #45a049;
    }
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background-color: #f5f5f5;
    }
    .content-wrapper {
      padding: 20px; margin-bottom: 140px;
    }
    h1 {
      text-align: center; margin-top: 0; font-size: 1.5em;
    }
    #controls {
      display: flex; flex-direction: column; align-items: center;
      gap: 10px; margin-bottom: 20px;
    }
    select, input[type="file"], button {
      padding: 10px; font-size: 14px;
      border-radius: 5px; border: 1px solid #ccc;
    }
    button {
      background-color: var(--button-bg);
      color: white; border: none; cursor: pointer;
    }
    button:hover {
      background-color: var(--button-hover);
    }
    .number-container {
      display: flex; justify-content: center; flex-wrap: wrap;
      gap: 5px;
    }
    .number {
      display: inline-flex; align-items: center; justify-content: center;
      width: 32px; height: 32px;
      background: var(--neutral-color); color: white;
      border-radius: 50%; font-weight: bold;
    }
    .superzahl-display {
      background: #FFC107; color: #333;
    }
    .chart-container {
      margin-bottom: 30px;
    }
    canvas {
      background: white; border-radius: 8px; padding: 10px;
    }
    .heatmap-container {
      width: 100%; max-height: 600px; overflow: auto;
    }
    .advanced-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px; margin-top: 20px;
    }
    .stat-box {
      padding: 15px; background: #f8f9fa; border-radius: 8px;
      border-left: 4px solid var(--neutral-color);
    }
    .stat-box.hot {
      border-color: var(--hot-color);
    }
    #topNumbersFooter {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: #e9e9e9; padding: 10px; text-align: center;
      border-top: 2px solid var(--neutral-color); z-index: 1000;
    }
    #topNumbersFooter h2 {
      margin: 0 0 5px 0; font-size: 0.9em;
    }
    @media (max-width: 480px) {
      .number { width: 28px; height: 28px; font-size: 13px; }
    }
  </style>
</head>
<body>
  <div class="content-wrapper">
    <h1>Lotto 6aus49 KI-Analyzer</h1>
    <div id="controls">
      <button id="githubBtn">Daten von GitHub laden</button>
      <input type="file" id="fileInput" accept=".json" />
      <select id="dataSubsetSelect">
        <option value="all">Alle Ziehungen verwenden</option>
        <option value="3000">Letzte 3000 Ziehungen</option>
        <option value="2000">Letzte 2000 Ziehungen</option>
        <option value="1000">Letzte 1000 Ziehungen</option>
        <option value="500">Letzte 500 Ziehungen</option>
        <option value="100">Letzte 100 Ziehungen</option>
        <option value="50">Letzte 50 Ziehungen</option>
        <option value="25">Letzte 25 Ziehungen</option>
        <option value="10">Letzte 10 Ziehungen</option>
      </select>
      <button id="analyzeBtn" disabled>Analyse starten</button>
      <div id="loadingStatus" class="loading-message" style="display: none; color: #888;"></div>
    </div>

<div class="chart-container">
      <h3>Häufigkeit Lottozahlen (1–49)</h3>
      <canvas id="freqChart" width="600" height="300"></canvas>
    </div>

    <div class="chart-container">
      <h3>Häufigkeit Superzahlen (0–9)</h3>
      <canvas id="superzahlFreqChart" width="600" height="300"></canvas>
    </div>

    <div class="advanced-stats">
      <div class="stat-box" id="chiSquareResult">
        <h3>Chi-Quadrat-Test</h3>
        <p>Lädt...</p>
      </div>
      <div class="stat-box" id="hotColdInfo">
        <h3>Hot/Cold-Zahlen</h3>
        <div id="hotColdNumbers" class="number-container"></div>
      </div>
      <div class="stat-box">
        <h3>Entropie (Lottozahlen)</h3>
        <canvas id="entropyGauge" width="300" height="150"></canvas>
      </div>
    </div>

    <div class="chart-container">
      <h3>Übergangswahrscheinlichkeiten (Heatmap)</h3>
      <div class="heatmap-container">
        <canvas id="transitionHeatmap" width="600" height="600"></canvas>
      </div>
    </div>

    <div class="advanced-stats">
      <div class="stat-box">
        <h3>KI-basierte Vorhersage</h3>
        <p>Diese Zahlen kombinieren Häufigkeit, Trends, Entropie & Übergänge:</p>
        <div id="kiTopNumbers" class="number-container"></div>
      </div>
      <div class="stat-box" style="max-height: 200px; overflow-y: auto;">
        <h3>Dieter-Prognose (Mehr-Ebenen-Analyse)</h3>
        <p>Langzeit-Defizit + Kurzfrist-Filter + KI-Gewichtung:</p>
        <div id="dieterPrognoseList" class="number-container"></div>
      </div>
    </div>

    <div id="topNumbersFooter">
      <div class="top-section">
        <h2>Top 6 Lottozahlen</h2>
        <div id="topLottozahlenList" class="number-container"></div>
      </div>
      <div class="top-section">
        <h2>Top Superzahl</h2>
        <div id="topSuperzahlList" class="number-container"></div>
      </div>
    </div>

<script>
      const GITHUB_URL = "https://raw.githubusercontent.com/JohannesFriedrich/LottoNumberArchive/5c85bef99dbcc4c812fe339c69c1e5f0c3dc351b/Lottonumbers_complete.json";
      let allLottoEntries = [], chartInstances = {}, transitionMatrix = [], chiSquareResult = 0, expectedFrequency = 0, hotColdMap = [], entropyChart;

      window.addEventListener('load', () => loadGitHubJson());
      document.getElementById('githubBtn').addEventListener('click', loadGitHubJson);
      document.getElementById('fileInput').addEventListener('change', handleFileInput);
      document.getElementById('analyzeBtn').addEventListener('click', performAnalysis);

      function showLoadingMessage(msg) {
        const el = document.getElementById('loadingStatus');
        el.textContent = msg; el.style.display = 'block';
      }
      function hideLoadingMessage() {
        document.getElementById('loadingStatus').style.display = 'none';
      }

      async function loadGitHubJson() {
        document.getElementById('analyzeBtn').disabled = true;
        showLoadingMessage("Lade Daten von GitHub...");
        try {
          const res = await fetch(GITHUB_URL);
          if (!res.ok) throw new Error(res.status);
          const json = await res.json();
          validateAndProcessData(json, "GitHub");
        } catch (err) { handleError("Ladefehler: ", err); }
        finally { hideLoadingMessage(); }
      }

      function handleFileInput(e) {
        const file = e.target.files[0]; if (!file) return;
        showLoadingMessage("Verarbeite Datei...");
        const reader = new FileReader();
        reader.onload = evt => {
          try {
            const json = JSON.parse(evt.target.result);
            validateAndProcessData(json, "Datei");
          } catch (err) { handleError("Parsefehler: ", err); }
          finally { hideLoadingMessage(); }
        };
        reader.readAsText(file);
      }

      function validateAndProcessData(json, source) {
        if (!json || !Array.isArray(json.data)) throw new Error("Struktur");
        allLottoEntries = json.data;
        if (!allLottoEntries.length) throw new Error("Keine Daten");
        document.getElementById('analyzeBtn').disabled = false;
        alert(`Daten von ${source} geladen: ${allLottoEntries.length} Ziehungen.`);
      }

      function computeEntropy(freqs) {
        const total = freqs.reduce((a,b) => a+b, 0);
        return freqs.reduce((sum,c) => c===0 ? sum : sum - (c/total)*Math.log2(c/total), 0);
      }


// Aktualisierte Entropie-Grafik-Funktion mit 180°-Kreis wie in Version 4
    function renderEntropyGauge(entropy) {
      const ctx = document.getElementById('entropyGauge').getContext('2d');
      if (chartInstances.entropyGauge) chartInstances.entropyGauge.destroy();

      const maxEntropy = Math.log2(49);
      chartInstances.entropyGauge = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Entropie', 'Rest'],
          datasets: [{
            data: [entropy, maxEntropy - entropy],
            backgroundColor: ['#4CAF50', '#e0e0e0']
          }]
        },
        options: {
          responsive: true,
   //       maintainAspectRatio: false,
          cutout: '70%',
          rotation: 270,
          circumference: 180,
          plugins: {
            legend: { display: true, position: 'bottom' },
            title: {
              display: true,
              text: `Entropie: ${entropy.toFixed(2)} / ${maxEntropy.toFixed(2)}`
            }
          }
        }
      });
    }


     function classifyHotColdNumbers(freqs) {
        const mean = freqs.reduce((a, b) => a + b, 0) / freqs.length;
        return freqs.map((f, i) => ({
          number: i + 1,
          status: f > mean * 1.02 ? 'hot' : f < mean * 0.98 ? 'cold' : 'neutral',
          count: f
        }));
      }

     function renderHotColdNumbers(freqs) {
        hotColdMap = classifyHotColdNumbers(freqs);
        const el = document.getElementById('hotColdNumbers');
        el.innerHTML = hotColdMap.map(n => `
          <span class="number" style="background:${{
            hot: 'var(--hot-color)',
            cold: 'var(--cold-color)',
            neutral: 'var(--neutral-color)'
          }[n.status]}">${n.number}</span>`).join('');
      }

      function calculateTransitionMatrix(data) {
        transitionMatrix = Array(49).fill().map(() => Array(49).fill(0));
        data.forEach(e => {
          const nums = e.Lottozahl.map(n => parseInt(n)).sort((a, b) => a - b);
          for (let i = 0; i < nums.length - 1; i++) {
            const from = nums[i] - 1;
            const to = nums[i + 1] - 1;
            if (from >= 0 && to >= 0) transitionMatrix[from][to]++;
          }
        });
      }

      function calculateChiSquare(obs) {
        const total = obs.reduce((a, b) => a + b, 0);
        expectedFrequency = total / 49;
        chiSquareResult = obs.reduce((sum, o) => sum + ((o - expectedFrequency) ** 2) / expectedFrequency, 0);
      }

        function renderChiSquareResult() {
        const critical = 65.171;
        const significant = chiSquareResult > critical;
        const box = document.getElementById('chiSquareResult');
        box.className = `stat-box ${significant ? 'hot' : ''}`;
        box.innerHTML = `
          <h3>Chi-Quadrat-Test</h3>
          <p>Wert: ${chiSquareResult.toFixed(2)}</p>
          <p>Erwartet: ${expectedFrequency.toFixed(1)}</p>
          <p>Signifikanz: ${significant ? '⚠️ Abweichung' : '✅ Normal'}</p>
        `;
      }


     function getTopNumbers(freqs, count, isSuper = false) {
        return freqs.map((c, i) => ({ number: isSuper ? i : i + 1, count: c }))
                    .sort((a, b) => b.count - a.count)
                    .slice(0, count);
      }


     function calculateKIScores() {
        return Array.from({ length: 49 }, (_, i) => {
          const hotCold = hotColdMap[i] || { status: "neutral", count: 0 };
          const hotColdFactor = {
            hot: 1.1,
            cold: 0.85,
            neutral: 1.0
          }[hotCold.status];
          const transitions = Array.isArray(transitionMatrix[i]) ? transitionMatrix[i] : [];
          const transitionBonus = transitions.reduce((a, b) => a + b, 0) / 10;
          const chiFactor = chiSquareResult > 65 ? 1.1 : 1.0;
          const entropyFactor = 1.0;
          const f = hotCold.count || 0;

          return {
            number: i + 1,
            score: f * hotColdFactor * chiFactor * entropyFactor + transitionBonus
          };
        });
      }

      function renderKIVorhersage(freqs, entropy) {
        const scores = calculateKIScores();
        const top = scores.sort((a, b) => b.score - a.score).slice(0, 6);
        const el = document.getElementById('kiTopNumbers');
        el.innerHTML = top.map(n => `<span class="number">${n.number}</span>`).join('');
      }

      function ermittleDieterPrognose() {
        function findeSeltenste(entries, anz = 18) {
          const freq = Array(49).fill(0);
          entries.forEach(e => e.Lottozahl?.forEach(z => freq[parseInt(z) - 1]++));
          return freq.map((count, i) => ({ zahl: i + 1, count }))
                     .sort((a, b) => a.count - b.count)
                     .slice(0, anz)
                     .map(e => e.zahl);
        }

        const alle = allLottoEntries;
        const letzte1000 = allLottoEntries.slice(-1000);
        const letzte100 = allLottoEntries.slice(-100);
        const letzte10 = allLottoEntries.slice(-10);

        const seltenAlle = findeSeltenste(alle);
        const selten1000 = findeSeltenste(letzte1000, 25);
        const selten100 = findeSeltenste(letzte100, 25);
        const selten10 = findeSeltenste(letzte10, 25);

        const kombiSet = new Set([...selten1000, ...selten100, ...selten10]);
        const kandidaten = seltenAlle.filter(z => kombiSet.has(z));

        const kiScores = calculateKIScores();
        const bewertet = kandidaten.map(z => ({
          zahl: z,
          score: kiScores[z - 1]?.score || 0
        }));

        const top6 = bewertet.sort((a, b) => b.score - a.score).slice(0, 6);
        const el = document.getElementById("dieterPrognoseList");
        el.innerHTML = top6.map(e => `<span class="number">${e.zahl}</span>`).join('');
      }

      function renderFreqChart(freqs, id, label, max, isSuper = false) {
        const ctx = document.getElementById(id)?.getContext('2d');
        if (!ctx) return;
        if (chartInstances[id]) chartInstances[id].destroy();
        const labels = Array.from({ length: max }, (_, i) => isSuper ? i : i + 1);
        chartInstances[id] = new Chart(ctx, {
          type: 'bar',
          data: {
            labels,
            datasets: [{
              label, data: freqs,
              backgroundColor: '#4CAF50',
              borderColor: '#388E3C',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
            scales: {
              y: { beginAtZero: true },
              x: { title: { display: true, text: label } }
            }
          }
        });
      }

    function renderTransitionHeatmap() {
        const ctx = document.getElementById('transitionHeatmap')?.getContext('2d');
        if (!ctx) return;
        if (chartInstances.transitionHeatmap) chartInstances.transitionHeatmap.destroy();

        const matrixData = transitionMatrix.flatMap((row, x) =>
          row.map((val, y) => ({ x, y, v: val }))
        );

        chartInstances.transitionHeatmap = new Chart(ctx, {
          type: 'matrix',
          data: {
            datasets: [{
              label: 'Heatmap',
              data: matrixData,
              width: 10,
              height: 10,
              backgroundColor: ctx => {
                const v = ctx.raw.v;
                const alpha = Math.min(v / 10, 0.9);
                return `rgba(255, 68, 68, ${alpha})`;
              }
            }]
          },
          options: {
            plugins: {
              tooltip: {
                callbacks: {
                  title: ctx => `Von ${ctx[0].raw.x + 1} zu ${ctx[0].raw.y + 1}`,
                  label: ctx => `Häufigkeit: ${ctx.raw.v}`
                }
              }
            }
          }
        });
      }

        function renderTopLottozahlen(arr) {
        const el = document.getElementById('topLottozahlenList');
        el.innerHTML = arr.map(n => `<span class="number">${n.number}</span>`).join('');
      }

    function renderTopSuperzahl(arr) {
        const el = document.getElementById('topSuperzahlList');
        el.innerHTML = arr.length
          ? `<span class="number superzahl-display">${arr[0].number}</span>`
          : "Keine Daten";
      }

    function getDatensatzSubset() {
        const select = document.getElementById('dataSubsetSelect');
        const value = select.value;
        if (value === 'all') return [...allLottoEntries];
        const count = parseInt(value);
        return allLottoEntries.slice(-count);
      }

      function performAnalysis() {
        const daten = getDatensatzSubset();
        const lottoFreqs = Array(49).fill(0);
        const superFreqs = Array(10).fill(0);
        const superStart = new Date(1991, 11, 7);

        daten.forEach(e => {
          if (Array.isArray(e.Lottozahl)) {
            e.Lottozahl.forEach(n => {
              const z = parseInt(n);
              if (z >= 1 && z <= 49) lottoFreqs[z - 1]++;
            });
          }
          if (e.Superzahl != null && e.date) {
            const [d, m, y] = e.date.split('.');
            const date = new Date(+y, m - 1, +d);
            if (date >= superStart) {
              const sz = parseInt(e.Superzahl);
              if (sz >= 0 && sz <= 9) superFreqs[sz]++;
            }
          }
        });

       const entropy = computeEntropy(lottoFreqs);
        renderHotColdNumbers(lottoFreqs);
        calculateTransitionMatrix(daten);
        calculateChiSquare(lottoFreqs);
        renderChiSquareResult();
        renderKIVorhersage(lottoFreqs, entropy);
        ermittleDieterPrognose();
        renderFreqChart(lottoFreqs, 'freqChart', 'Lottozahlen 1–49', 49);
renderEntropyGauge(entropy);
        renderFreqChart(superFreqs, 'superzahlFreqChart', 'Superzahlen 0–9', 10, true);
        renderTopLottozahlen(getTopNumbers(lottoFreqs, 6));
        renderTopSuperzahl(getTopNumbers(superFreqs, 1, true));
        renderTransitionHeatmap();
      }

      function handleError(msg, err) {
        console.error(msg, err);
        alert(msg + err.message);
      }

    </script>
  </body>
</html>




